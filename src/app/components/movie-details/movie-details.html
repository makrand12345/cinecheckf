<div class="movie-details-container">
    <div class="container">
        @if (loading) {
            <div class="loading">
                <i class="fas fa-spinner fa-spin"></i>
                <p>Loading movie details...</p>
            </div>
        } @else if (movie) {
            <div class="movie-header">
                <button class="back-btn" (click)="goBack()">
                    <i class="fas fa-arrow-left"></i> Back to Movies
                </button>
                
                <div class="movie-hero">
                    <div class="movie-poster-large">
                        <img [src]="movie.poster_url" [alt]="movie.title">
                    </div>
                    
                    <div class="movie-info-large">
                        <h1>{{ movie.title }}</h1>
                        <div class="movie-meta">
                            <span class="rating"><i class="fas fa-star"></i> {{ movie.rating || 'N/A' }}</span>
                            <span class="duration"><i class="fas fa-clock"></i> {{ movie.duration }} min</span>
                            <span class="year"><i class="fas fa-calendar"></i> {{ getYear(movie.release_date) }}</span>
                            <span class="age-rating">{{ movie.age_rating }}</span>
                        </div>
                        
                        <div class="genres">
                            @for (genre of movie.genres; track genre) {
                                <span class="genre-tag">{{ genre }}</span>
                            }
                        </div>
                        
                        <p class="description">{{ movie.description }}</p>
                        
                        <div class="details-grid">
                            <div class="detail-item">
                                <strong>Director:</strong> {{ movie.director }}
                            </div>
                            <div class="detail-item">
                                <strong>Language:</strong> {{ movie.language }}
                            </div>
                            <div class="detail-item">
                                <strong>Country:</strong> {{ movie.country }}
                            </div>
                        </div>
                        
                        <div class="action-buttons">
                            @if (movie.trailer_url) {
                                <button class="trailer-btn" (click)="openTrailer()">
                                    <i class="fas fa-play"></i> Watch Trailer
                                </button>
                            }
                            <button class="watchlist-btn" 
                                    [class.active]="inWatchlist"
                                    (click)="toggleWatchlist()"
                                    [disabled]="loadingWatchlist">
                                <i class="fas" [class.fa-heart]="inWatchlist" [class.fa-heart-o]="!inWatchlist"></i>
                                {{ inWatchlist ? 'In Watchlist' : 'Add to Watchlist' }}
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Rating Section -->
            @if (currentUser) {
                <div class="rating-section">
                    <h2>Rate this Movie</h2>
                    <div class="rating-form">
                        <div class="stars">
                            @for (star of [1,2,3,4,5]; track star) {
                                <i class="fas fa-star" 
                                   [class.filled]="star <= selectedRating"
                                   (click)="setRating(star)"></i>
                            }
                        </div>
                        <textarea [(ngModel)]="reviewText" placeholder="Write your review (optional)" class="review-textarea"></textarea>
                        <button class="submit-rating-btn" (click)="submitRating()" [disabled]="!selectedRating">
                            Submit Rating
                        </button>
                    </div>
                </div>
            } @else {
                <div class="rating-section">
                    <p>Please <a routerLink="/auth">login</a> to rate and review this movie.</p>
                </div>
            }

            @if (error) {
                <div class="error-message">
                    <p>{{ error }}</p>
                </div>
            }

            <!-- Reviews Section -->
            <div class="reviews-section">
                <h2>User Reviews ({{ reviews.length }})</h2>
                @if (reviews.length > 0) {
                    <div class="reviews-list">
                        @for (review of reviews; track review.id) {
                            <div class="review-card">
                                <div class="review-header">
                                    <strong>{{ review.username }}</strong>
                                    <div class="review-rating">
                                        @for (star of [1,2,3,4,5]; track star) {
                                            <i class="fas fa-star" [class.filled]="star <= review.rating"></i>
                                        }
                                    </div>
                                </div>
                                @if (review.review_text) {
                                    <p class="review-text">{{ review.review_text }}</p>
                                }
                                <small class="review-date">{{ formatDate(review.created_at) }}</small>
                            </div>
                        }
                    </div>
                } @else {
                    <p class="no-reviews">No reviews yet. Be the first to rate this movie!</p>
                }
            </div>
        } @else if (error) {
            <div class="error-message">
                <i class="fas fa-exclamation-triangle"></i>
                <h3>Error Loading Movie</h3>
                <p>{{ error }}</p>
                <div class="error-actions">
                    <button class="retry-btn" (click)="retryLoadMovie()">
                        <i class="fas fa-redo"></i> Try Again
                    </button>
                    <button class="back-btn" (click)="goBack()">
                        <i class="fas fa-arrow-left"></i> Go Back
                    </button>
                </div>
            </div>
        }
    </div>
</div>